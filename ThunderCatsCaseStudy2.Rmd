---
title: "Thundercats Case Study 2"
author: "TEAM THUNDERCATS DDS SMU"
date: "7/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(sqldf)
```

## Load the data
```{r}
attrition_data = read_csv('atttrition.csv')

```
## EDA Phase 1: Plotting
  
  # By Age (abstract into histogram analysis?)
```{r}
#let's partiton by attrition and look at the data a bit
left_data = sqldf("SELECT * FROM attrition_data WHERE Attrition = 'Yes'")
stayed_data = sqldf("SELECT * FROM attrition_data WHERE Attrition = 'No'")

ggplot(data=left_data, aes(left_data$Age)) + geom_histogram(binwidth = 3) 
ggplot(data=stayed_data, aes(stayed_data$Age)) + geom_histogram(binwidth = 3) 

```
 # By Department (abstract into categorical analysis)

```{r}

counts_by_department = sqldf('SELECT 
                                  Department
                                  ,Attrition
                                  ,COUNT(*)*1.0  as Count
                             FROM attrition_data 
                             GROUP BY Department
                                     , Attrition')

yes_by_department =sqldf("SELECT * FROM counts_by_department WHERE Attrition = 'Yes'")
no_by_department =sqldf("SELECT * FROM counts_by_department WHERE Attrition = 'No'")

ggplot(yes_by_department, aes(x=yes_by_department$Department, y=yes_by_department$Count, fill=yes_by_department$Department)) + geom_bar(stat = "identity") + labs(x = 'Department', y='# Attrition', fill='Department') 
ggplot(no_by_department, aes(x=no_by_department$Department, y=no_by_department$Count, fill=no_by_department$Department)) + geom_bar(stat = "identity") + labs(x = 'Department', y='# Attrition', fill='Department') 

attrition_rates = sqldf("SELECT
          y.Department,
          y.Count as Departed,
          n.Count as Employed,
          (y.Count/(n.Count + y.Count)) as AttritionRate
       FROM yes_by_department y
       LEFT JOIN no_by_department n ON n.Department = y.Department")

```



```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
